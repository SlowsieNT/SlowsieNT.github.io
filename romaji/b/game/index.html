<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width">
	<title>Ja111K Memory Game</title>
	<meta name="description" content="Learn 111K+ Japanese words (Kanji/Romaji included)">
	<meta name="keywords" content="Ja111K Game, 111k words game, 111000 words game, Ja111K Memory Game, Game, Memory, Ja111K, Japanese Game, Japanese Memory Game">
<script src="../ja-wordlist-part1.js"></script>
<script src="../ja-wordlist-part2.js"></script>
<script>
	var jaDict = vJAWList;
</script>
<style>
	html {width:100%;height:100%;}
	body {background-color: #111;color:gray;margin:0;padding:8px;}
	.w32 {width:32px;} .w48 {width:48px;} .w64 {width:64px;}
	.w240 {width:240px;} .w300 {width:300px;} .w320 {width:320px;} .w360 {width:360px;}
	.w480 {width:480px;} .w640 {width:640px;} .w720 {width:720px;}
	.mw2{margin-left:2px;}.mw4 {margin-left:4px;}.mw6{margin-left:6px;}
	.mw8 {margin-left: 8px;}.mw10 {margin-left: 10px;}.mw12 {margin-left: 12px;}
	.mw14 {margin-left: 14px;}.mw16 {margin-left: 16px;}.mw18 {margin-left: 18px;}
	.mn2 {margin-top:2px;}.mn4{margin-top:4px;}.mn6{margin-top:6px;}
	.mn8 {margin-top:8px;}.mn10{margin-top:10px;}.mn12{margin-top:12px;}
	.p8{padding:8px;}
	.es01, .bs01 {
		border:1px gray solid;
		background-color: #222;
		color:lime;outline:none;
	}
	.bs01:hover {background-color: #444;}
	.hline {border-top:1px lime solid;margin-top:4px;margin-bottom:4px;}
</style>
</head>
<body>
	<h2><script>document.write(document.title);</script></h2>
	<div><i>Disclaimer: Design was never intended to be pleasing.</i></div>
	<div class="hline"></div>
	<b id="lbWordsCount">N/A</b> words.
	<div class="hline"></div>
	<div>
		<table>
			<tr>
				<td>
					<span>Words per page</span>
					<div><input id="tbWordsPerPage" class="w48 es01" type="number" value="200" min="1"></div>
				</td>
				<td>
					<div class="mw16">
						<span>Answers per word</span>
						<div><input id="tbAnsPerWord" class="w32 es01" type="number" value="5" min="4" max="50"></div>
					</div>
				</td>
			</tr>
		</table>
		<div class="hline"></div>
		<div>
			<button id="btnPrev1" class="bs01">&lt; Back</button>
			<button id="btnNext1" class="bs01 mw4">Next &gt;</button>
			Page:
			<input id="tbCurrentPage" class="w48 es01" type="number" value="1">
			/&nbsp;<b id="lbTotalPages">1</b>
		</div>
		<div class="hline"></div>
		<table>
			<tr>
				<td>
					<span>Correct</span>
					<div><b id="lbCorrect1">0</b></div>
				</td>
				<td>
					<div class="mw16">
						<span>Learning</span>
						<div><b id="lbLearning1">0</b></div>
					</div>
				</td>
			</tr>
		</table>
		<div class="hline"></div>
		<div>
			<span style="font-size:24px">What is the meaning of <b id="lbQWord">N/A</b>?</span>
		</div>
		<div id="liAnswers"></div>
		<script>
var Game = {
	Dict: jaDict,
	Settings: {
		AnswerDelay: 2e3,
		AnswersPerWord: 5
	},
	Stats: {
		Correct: 0,
		Learning: 0,
		WordsDone: [],
		Wordlist: [],
		_: 0
	},
	Utils: {
		ShuffleArray: function (aArray) {
			var aLen = aArray.length;
			while (0 !== aLen) {
				// Pick a remaining element then Swap
				var iRand = 0|aLen*Math.random(),
					temp = aArray[--aLen];
				aArray[aLen] = aArray[iRand];
				aArray[iRand] = temp;
			}
			return aArray;
		}
	},
	UI: {
		// UI Handles:
		LbWordsCount: id("lbWordsCount"),
		TbWordsPerPage: id("tbWordsPerPage"),
		TbAnsPerWord: id("tbAnsPerWord"),
		LiAnswers: id("liAnswers"),
		BtnPrev1: id("btnPrev1"),
		BtnNext1: id("btnNext1"),
		LbQWord: id("lbQWord"),
		LbCorrect1: id("lbCorrect1"),
		LbLearning: id("lbLearning1"),
		TbCurrentPage: id("tbCurrentPage"),
		LbTotalPages: id("lbTotalPages"),
		// Functions:
		CreateAnswer: function (aButton1HTML, aMarginTop) {
			var holder = ce("div");
			holder.style.marginTop = aMarginTop + "px";
			holder.innerHTML = '<button class="bs01 p8"></button>';
			var btn = holder.getElementsByTagName("button")[0];
			btn.innerHTML = aButton1HTML;
			return {
				Button: btn,
				Handle: holder
			};
		},
		RenderAnswers: function (aAnswerArr, aCorrectAnswer) {
			var _ = this, elements = [];
			_.LiAnswers.innerHTML = "";
			if (window.Ja111DEBUGGING)
				console.log(aCorrectAnswer[1][0]);
			for (var i in aAnswerArr) {
				// oItem[0 word, 1 words[][0 kanji, 1 romaji, 2 word-type, 3 translation]]
				if (!(i >= 0)) continue;
				var oItem = aAnswerArr[i][1][0],
					hAns = _.CreateAnswer(oItem[3], (i > 0 ? 4 : 16)),
					cAnswer = aCorrectAnswer[1][0];
				hAns.IsAnswer = cAnswer[1] === oItem[1];
				hAns.Handle.HData = hAns;
				hAns.Handle.onclick = function () {
					_.OnAnswer(this, elements, aCorrectAnswer);
				};
				elements.push(hAns);
				_.LiAnswers.appendChild(hAns.Handle);
			}
		},
		OnAnswer: function (aAnswerHandle, aAnswerHandles, aCorrectAnswer) {
			// aAnswerHandles[] {Button, Handle}
			for (var i in aAnswerHandles)
				if (!aAnswerHandles[i].IsAnswer)
					aAnswerHandles[i].Handle.style.display = "none";
			// aCorrectAnswer[0 word, 1 words[][0 kanji, 1 romaji, 2 word-type, 3 translation]]
			var ansH = aAnswerHandle.HData, flag1 = ansH.IsAnswer;
			Game.Stats.Correct += flag1;
			Game.Stats.Learning += !flag1;
			// ui
			Game.UI.Update(2);
			// etc
			ansH.Button.innerHTML = (
				aCorrectAnswer[1][0][2] + "<br>" + aCorrectAnswer[1][0][3]
			);
			Game.Stats.WordsDone.push(aCorrectAnswer[0]);
			// render random word
			setTimeout(Game.UI.RenderRand, Game.Settings.AnswerDelay);
		},
		Update: function (aType) {
			if (2 === aType) {
				Game.UI.LbCorrect1.innerHTML = Game.Stats.Correct;
				Game.UI.LbLearning.innerHTML = Game.Stats.Learning;
			}
			if (1 === aType) {
				Game.UI.LbCorrect1.innerHTML = Game.Stats.Correct = 0;
				Game.UI.LbLearning.innerHTML = Game.Stats.Learning = 0;
			}
		},
		RenderRand: function () {
			var aArray = Game.Stats.Wordlist,
				aArrayLen = aArray.length;
			for (var tmpArr = [], wd = Game.Stats.WordsDone, wLen = wd.length, i = 0; i < wLen; i++) {
				var canAdd = 1;
				for (var i2 in aArray)
					if (aArray[i2][0] == wd[i])
						canAdd = 0;
				if (canAdd)
					tmpArr.push(wd[i]);
			}
			if (tmpArr.length > 0)
				aArray = tmpArr, aArrayLen = aArray.length;
			// etc
			var items = [],
				correctAnswerIdx = 0|Math.random()*aArrayLen,
				correctAnswer = aArray[correctAnswerIdx],
				answers = [correctAnswer];
			Game.UI.LbQWord.innerHTML = correctAnswer[0] + " ("+correctAnswer[1][0][0]+")";
			// Allocate decoy items
			for (var i in aArray)
				if (i !== correctAnswerIdx)
					items.push(aArray[i]);
			// First shuffle array without correct answer
			Game.Utils.ShuffleArray(items);
			// Then push random answers
			for (var i = 0; i < -1 + Game.Settings.AnswersPerWord; i++)
				if (items[i]) answers.push(items[i]);
			// Now shuffle the answers array
			Game.Utils.ShuffleArray(answers);
			// Finally render them
			Game.UI.RenderAnswers(answers, correctAnswer);
		},
		ResolveHandlers: function () {
			Game.UI.Pag1 = Paginator.Create(
				[0, Game.Dict],
				+Game.UI.TbWordsPerPage.value,
				+Game.UI.TbCurrentPage.value,
				function Update(aPageItems, aPageItemsLen, aPerPage, aPageNum, aPageCount, aArrayLen) {
					Game.UI.TbCurrentPage.value = aPageNum;
					Game.UI.LbWordsCount.innerHTML = aArrayLen.toLocaleString();
					Game.UI.LbTotalPages.innerHTML = aPageCount;
					Game.Stats.Wordlist = aPageItems;
					Game.UI.Update(1);
					Game.UI.RenderRand();
				}
			);
			var ois = null === document.body.oninput;
			Game.UI.TbAnsPerWord[ois?"oninput":"onkeyup"] = function () {
				Game.Settings.AnswersPerWord = 0|this.value;
				var apw = Game.Settings.AnswersPerWord;
				if (apw > 50)
					Game.Settings.AnswersPerWord = 50;
				if (apw < 4)
					Game.Settings.AnswersPerWord = 4;
				this.value = Game.Settings.AnswersPerWord;
			};
			Game.UI.TbWordsPerPage[ois?"oninput":"onkeyup"] = function () {
				Game.UI.Pag1.PerPage(this.value);
			};
			Game.UI.TbCurrentPage[ois?"oninput":"onkeyup"] = function () {
				var cpn = Game.UI.Pag1.PageNum();
				if (this.value > cpn)
					this.value = Game.UI.Pag1.PageCount();
				Game.UI.Pag1.PageNum(this.value);
			};
			Game.UI.BtnNext1.onclick = Game.UI.Pag1.Next;
			Game.UI.BtnPrev1.onclick = Game.UI.Pag1.Prev;
		}
	}
};
var Paginator = new function () {
	var _ = this, mArray;
	// aDataConf[0 dataType [0 array, 1 obj], 1 arrayOrObject]
	_[0] = _.Create = function (aDataConf, aPerPage, aPageNum, aFnUpdateUI, aFnBeforeResolve) {
		var cArray,
			ret = {},
			ArrayLen = 0,
			PageNum = 1, PerPage = 1, PageCount = 1,
			zzz = 0;
		function ResolveData(aDataConf, aPageNum, aPerPage) {
			if (aDataConf[0]) {
				cArray = [];
				for (var n in aDataConf[1])
					cArray.push([n, aDataConf[1][n]]);
				mArray = cArray;
			} else mArray = aDataConf[1];
			ArrayLen = mArray.length;
			PageNum = ResolvePageNum(0|aPageNum);
			PerPage = Math.abs(0|aPerPage);
			if (1 > PerPage) PerPage = 1;
			PageCount = Math.ceil(ArrayLen/PerPage);
			ret.Update();
		}
		function ResolvePageNum(aPageNum, aCallUpdate) {
			var flag1 = aPageNum > 0 && aPageNum <= PageCount;
			if (aPageNum != PageNum && flag1)
				PageNum = aPageNum;
			if (flag1 && aCallUpdate)
				ret.Update();
			return PageNum;
		}
		// etc
		ret[0] = ret.PageNum = ret.pageNum = ret.Page = ret.page = function (aPageNum) {
			return ResolvePageNum(aPageNum, 1);
		};
		ret[1] = ret.PageCount = ret.pageCount = function () {
			return PageCount;
		};
		ret[2] = ret.PerPage = ret.perPage = ret.per = function (aPerPage) {
			var nPP = Math.abs(0|aPerPage);
			if (nPP !== PerPage && nPP >= 1)
				ret.Update(PerPage = nPP);
		};
		ret[3] = ret.Data = ret.data = ret.Items = ret.items = ResolveData;
		ret[4] = ret.Next = ret.next = ret.Forward = ret.forward = function () {
			return ret.PageNum(++PageNum);
		};
		ret[5] = ret.Prev = ret.Prev = ret.Back = ret.back = function () {
			return ret.PageNum(--PageNum);
		};
		ret[6] = ret.Update = function () {
			// Call upper Update
			if (aFnUpdateUI) {
				var tArray = mArray.slice((PageNum-1)*PerPage, PerPage+(PageNum-1)*PerPage);
				aFnUpdateUI(tArray, tArray.length, PerPage, PageNum, PageCount, ArrayLen);
			}
		};
		aFnBeforeResolve && aFnBeforeResolve();
		ResolveData(aDataConf, aPageNum, aPerPage);
		return ret;
	};
};

function id(id) {return document.getElementById(id);}
function ce(n) {return document.createElement(n);}


Game.UI.ResolveHandlers();
		</script>
		<div class="hline"></div>
		<div style="margin-top:32px"><i id="flicker722617809971422">No Rights reserved.</i></div>
		<div><i>Source Code License: <u>Unlicense</u>.</i></div>
		<script>
			(function(eBlink){
				var i = 0, pauseBlink;
				eBlink.onclick = function () { pauseBlink = !pauseBlink; };
				(function loop() {
					if (pauseBlink) return;
					eBlink.style.textDecoration = i++ & 1 ? "underline" : "none";
					eBlink.style.color = i & 1 ? "" : "lime";
					setTimeout(loop, 1e3);
				})();
			})(document.getElementById("flicker722617809971422"));
		</script>
	</div>
</body>
</html>
